<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/assets/app.css" rel="stylesheet"/>
    <title>Admin login</title>
</head>
<body class="bg-light" data-page="login">
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-4">
            <h1 class="h3 mb-3 text-center">Product Catalog Admin</h1>

            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="alert alert-info py-2 d-none" id="status"></div>

                    <form id="loginForm">
                        <div class="mb-3">
                            <label class="form-label" for="username">Username</label>
                            <input autocomplete="username" class="form-control" id="username" name="username" type="text" value="admin"/>
                        </div>

                        <div class="mb-3">
                            <label class="form-label" for="password">Password</label>
                            <input autocomplete="current-password" class="form-control" id="password" name="password" type="password" value="admin"/>
                        </div>

                        <button class="btn btn-primary w-100" type="submit">Login</button>
                    </form>

                    <div class="text-muted small mt-3">Credentials: admin / admin</div>
                </div>
            </div>

            <div class="text-center mt-3">
                <a class="link-secondary" href="/">Home</a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" type="text/javascript"></script>
<script type="text/javascript">window.melodyRoutes = JSON.parse('{{routes_json}}');</script>
<script src="/assets/app.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(() => {
        const form = $('#loginForm');
        if (0 === form.length) {
            return;
        }

        form.on('submit', async (event) => {
            event.preventDefault();

            window.melodyExample.ui.setStatus('Logging in...');

            try {
                const username = String(form.find('input[name="username"]').val() ?? '').trim();
                const password = String(form.find('input[name="password"]').val() ?? '').trim();

                const result = await window.melodyExample.http.postJson(
                    window.melodyExample.routing.route('example.login.submit'),
                    {
                        username: username,
                        password: password
                    }
                );

                window.melodyExample.ui.setStatus('OK');

                const redirectUrl = String(result?.payload?.redirectUrl ?? '').trim();
                if ('' !== redirectUrl) {
                    window.location.href = redirectUrl;
                    return;
                }

                window.location.href = window.melodyExample.routing.route('example.products.list.page');
            } catch (err) {
                window.melodyExample.ui.setStatus(String(err?.message ?? 'login failed'), 'danger');
            }
        });
    });
</script>
</body>
</html>
